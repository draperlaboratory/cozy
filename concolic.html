<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using Concolic Execution &#8212; cozy 1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <script src="_static/documentation_options.js?v=56dcb7b8"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Dealing with Hooks" href="hooks.html" />
    <link rel="prev" title="Launching a Visualization" href="launchingavisualization.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="using-concolic-execution">
<h1>Using Concolic Execution<a class="headerlink" href="#using-concolic-execution" title="Link to this heading">¶</a></h1>
<p>Concolic execution is a state exploration strategy that uses concrete values to
guide symbolic execution. cozy performs concolic execution slightly differently
than what you might be used to with angr, including angr’s Unicorn engine. In
our implementation of concolic execution, concrete values for each symbol are
chosen, and symbolic execution proceeds as normal. When a branch is created in
the symbolic execution, the concrete values are substituted into the constraints
of both children, and the children that evaluate to false are placed in a deferred
stash. Once execution reaches a terminal state, a deferred child is selected using
some heuristic, and its constraints are used to generate a new concrete input.
This is equivalent to negating a portion of the path constraint that you might
typically see in literature on concolic execution. Our core implementation of
concolic execution can be used outside of the cozy workflow as a standalone
exploration technique. The relevant classes if you wish to do this can be found
in the <a class="reference internal" href="autoapi/cozy/concolic/exploration/index.html#module-cozy.concolic.exploration" title="cozy.concolic.exploration"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cozy.concolic.exploration</span></code></a> module.</p>
<p>Since cozy is a comparative framework, we implement an additional strategy
called joint concolic execution. In joint concolic execution, we alternate
between the two programs when generating concrete values. After a concrete value
is implemented, we run both programs on the same concrete values, which automatically
leads to compatible state pairs being generated.</p>
<p>Note that like typical symbolic execution, concolic execution can be complete
if so desired. The execution is complete if there are no deferred states in either
program. However the primary benefit of concolic execution is that we can explore
promising paths at the expense of an incomplete analysis. The promising paths in cozy
are determined by heuristics. There are two different heuristics required for
concolic execution:</p>
<ol class="arabic simple">
<li><p>A termination heuristic, which determines when to halt concolic execution.</p></li>
<li><p>A candidate heuristic, which determines which deferred state to explore next.</p></li>
</ol>
<p>Some pre-made heuristics can be found in <a class="reference internal" href="autoapi/cozy/concolic/heuristics/index.html#module-cozy.concolic.heuristics" title="cozy.concolic.heuristics"><code class="xref py py-mod docutils literal notranslate"><span class="pre">cozy.concolic.heuristics</span></code></a>. Let’s
walk through an example of using a joint concolic session to explore how to use
<a class="reference internal" href="autoapi/cozy/concolic/session/index.html#cozy.concolic.session.JointConcolicSession" title="cozy.concolic.session.JointConcolicSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">cozy.concolic.session.JointConcolicSession</span></code></a>.</p>
<p>Let’s assume that we already have a prepatched and postpatched cozy project set up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sess_prepatched</span> <span class="o">=</span> <span class="n">proj_prepatched</span><span class="o">.</span><span class="n">session</span><span class="p">(</span><span class="s1">&#39;process_sensor_data&#39;</span><span class="p">)</span>
<span class="n">add_directives</span><span class="p">(</span><span class="n">sess_prepatched</span><span class="p">)</span>
<span class="n">initialize_state</span><span class="p">(</span><span class="n">sess_orig</span><span class="p">)</span>

<span class="n">sess_postpatched</span> <span class="o">=</span> <span class="n">proj_postpatched</span><span class="o">.</span><span class="n">session</span><span class="p">(</span><span class="s1">&#39;process_sensor_data&#39;</span><span class="p">)</span>
<span class="n">add_directives</span><span class="p">(</span><span class="n">sess_postpatched</span><span class="p">)</span>
<span class="n">initialize_state</span><span class="p">(</span><span class="n">sess_postpatched</span><span class="p">)</span>
</pre></div>
</div>
<p>We are now ready to create and run a joint concolic session. We must remember to pass
a set of symbols used in the program to the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code> method, as we need to assign
concrete values to every symbolic value. We also construct the candidate and termination
heuristics:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">joint_sess</span> <span class="o">=</span> <span class="n">JointConcolicSession</span><span class="p">(</span><span class="n">sess_prepatched</span><span class="p">,</span> <span class="n">sess_postpatched</span><span class="p">,</span>
                                  <span class="n">candidate_heuristic_left</span><span class="o">=</span><span class="n">BBTransitionCandidate</span><span class="p">(),</span>
                                  <span class="n">candidate_heuristic_right</span><span class="o">=</span><span class="n">BBTransitionCandidate</span><span class="p">(),</span>
                                  <span class="n">termination_heuristic_left</span><span class="o">=</span><span class="n">CyclomaticComplexityTermination</span><span class="o">.</span><span class="n">from_session</span><span class="p">(</span><span class="n">sess_prepatched</span><span class="p">),</span>
                                  <span class="n">termination_heuristic_right</span><span class="o">=</span><span class="n">CyclomaticComplexityTermination</span><span class="o">.</span><span class="n">from_session</span><span class="p">(</span><span class="n">sess_postpatched</span><span class="p">))</span>
<span class="p">(</span><span class="n">prepatched_results</span><span class="p">,</span> <span class="n">postpatched_results</span><span class="p">)</span> <span class="o">=</span> <span class="n">joint_sess</span><span class="o">.</span><span class="n">run</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">symbols</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we are setting heuristics so that we do not explore every state. Instead, our candidate
heuristic will pick states with the most unique basic block edge transitions in their history,
and the exploration will be terminated once the number of terminal states exceeds the
cyclomatic complexity of the session’s function. The return result from the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code> method gives two
<a class="reference internal" href="autoapi/cozy/session/index.html#cozy.session.RunResult" title="cozy.session.RunResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">RunResult</span></code></a> objects, which can be directly be used by
<a class="reference internal" href="autoapi/cozy/analysis/index.html#cozy.analysis.Comparison" title="cozy.analysis.Comparison"><code class="xref py py-class docutils literal notranslate"><span class="pre">cozy.analysis.Comparison</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_results</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">Comparison</span><span class="p">(</span><span class="n">prepatched_results</span><span class="p">,</span> <span class="n">postpatched_results</span><span class="p">)</span>
</pre></div>
</div>
<p>We can of course visualize the results in the browser:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here args is not the function arguments, but rather the contents of the memory</span>
<span class="c1"># mutated by initialize_state</span>
<span class="n">execution_graph</span><span class="o">.</span><span class="n">visualize_comparison</span><span class="p">(</span><span class="n">proj_prepatched</span><span class="p">,</span> <span class="n">proj_postpatched</span><span class="p">,</span>
                                     <span class="n">prepatched_results</span><span class="p">,</span> <span class="n">postpatched_results</span><span class="p">,</span>
                                     <span class="n">comparison_results</span><span class="p">,</span>
                                     <span class="n">concrete_arg_mapper</span><span class="o">=</span><span class="n">concrete_mapper</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                                     <span class="n">num_examples</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">open_browser</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The full implementation used in this guide can be found at
<a class="reference external" href="https://github.com/draperlaboratory/cozy/blob/main/examples/cmp_weather_v5_concolic.py">https://github.com/draperlaboratory/cozy/blob/main/examples/cmp_weather_v5_concolic.py</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">cozy</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="launchingavisualization.html">Launching a Visualization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using Concolic Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks.html">Dealing with Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="sideeffects.html">Modeling I/O Side Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="underconstrained.html">Underconstrained Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/index.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="launchingavisualization.html" title="previous chapter">Launching a Visualization</a></li>
      <li>Next: <a href="hooks.html" title="next chapter">Dealing with Hooks</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, The Charles Stark Draper Laboratory.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/concolic.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>